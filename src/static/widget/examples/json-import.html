<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metadata Agent – JSON-Import Beispiel</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Widget Styles -->
    <link rel="stylesheet" href="../dist/styles.css">

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Roboto', sans-serif;
            background: #f5f5f5;
            padding: 24px;
        }

        .page-header {
            max-width: 1400px;
            margin: 0 auto 16px;
        }

        .page-header h1 { font-size: 22px; font-weight: 500; color: #1d1b20; }
        .page-header p { color: #666; margin-top: 4px; font-size: 14px; }

        .controls {
            max-width: 1400px;
            margin: 0 auto 16px;
            padding: 16px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .controls h3 { font-size: 14px; margin-bottom: 8px; color: #333; }

        .btn-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }

        button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

        button:hover { background: #e3f2fd; border-color: #2196f3; }

        button.primary {
            background: #1976d2; color: white; border-color: #1976d2;
        }
        button.primary:hover { background: #1565c0; }

        .file-info {
            font-size: 13px; color: #666; margin-left: 12px;
        }

        .layout-switch {
            display: flex; gap: 6px; margin-top: 12px;
        }
        .layout-switch button.active {
            background: #1976d2; color: white; border-color: #1976d2;
        }

        .widget-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: 500px;
        }

        metadata-agent-canvas {
            display: block;
            width: 100%;
            min-height: 500px;
        }

        .json-preview {
            max-width: 1400px;
            margin: 16px auto 0;
            padding: 16px;
            background: #1e1e1e;
            color: #d4d4d4;
            border-radius: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow: auto;
            white-space: pre-wrap;
            display: none;
        }
    </style>
</head>
<body>

    <div class="page-header">
        <h1>JSON-Import Beispiel</h1>
        <p>Lädt Metadaten aus einer JSON-Datei und zeigt sie in der Webkomponente an.</p>
    </div>

    <div class="controls">
        <h3>Datenquelle</h3>
        <div class="btn-row">
            <button class="primary" onclick="loadExampleJson()">
                Beispiel-JSON laden (metadata-2026-02-11.json)
            </button>
            <button onclick="document.getElementById('fileInput').click()">
                Eigene JSON-Datei hochladen…
            </button>
            <input type="file" id="fileInput" accept=".json" style="display:none" onchange="loadFileJson(event)">
            <span class="file-info" id="fileInfo"></span>
        </div>

        <div class="layout-switch">
            <span style="font-size:13px; color:#666; margin-right:8px; line-height:32px;">Layout:</span>
            <button class="active" onclick="switchLayout('detail', this)">Detail (4-Spalten)</button>
            <button onclick="switchLayout('default', this)">Default</button>
            <button onclick="switchLayout('compact', this)">Compact</button>
            <button onclick="switchLayout('prueftisch', this)">Prüftisch</button>
        </div>
    </div>

    <div class="widget-container">
        <!--
            JSON-Import: Metadaten werden per JavaScript über metadataInput geladen.
            Siehe full.html für die vollständige Attribut-Dokumentation.
        -->
        <metadata-agent-canvas
            id="canvas"
            api-url="https://metadata-agent-api.vercel.app"
            layout="detail"
            context-name="default"
            schema-version="latest"
            columns="4"
            input-mode="text"
            show-input-area="false"
            show-status-bar="false"
            show-core-fields="true"
            show-special-fields="true"
            show-footer="false"
            show-floating-controls="true"
            show-field-actions="false"
            show-upload-button="false"
            show-page-mode="false"
            show-content-type-only="false"
            readonly="true"
            borderless="true"
            highlight-ai="false"
            auto-extract="false">
        </metadata-agent-canvas>
    </div>

    <pre class="json-preview" id="jsonPreview"></pre>

    <!-- Widget Scripts -->
    <script src="../dist/runtime.js" defer></script>
    <script src="../dist/polyfills.js" defer></script>
    <script src="../dist/main.js" defer></script>

    <script>
        const apiUrl = 'https://metadata-agent-api.vercel.app';
        document.getElementById('canvas').setAttribute('api-url', apiUrl);

        /**
         * Load the included example JSON file
         */
        async function loadExampleJson() {
            try {
                const resp = await fetch('metadata-2026-02-11.json');
                if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
                const data = await resp.json();
                applyMetadata(data, 'metadata-2026-02-11.json');
            } catch (err) {
                alert('Fehler beim Laden der Beispiel-JSON: ' + err.message);
            }
        }

        /**
         * Load a user-selected JSON file
         */
        function loadFileJson(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    applyMetadata(data, file.name);
                } catch (err) {
                    alert('Ungültige JSON-Datei: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        /**
         * Apply metadata to the web component
         */
        function applyMetadata(data, filename) {
            const canvas = document.getElementById('canvas');

            // Set context/schema from JSON if available
            if (data.contextName) canvas.setAttribute('context-name', data.contextName);
            if (data.schemaVersion) canvas.setAttribute('schema-version', data.schemaVersion);

            // Pass the metadata to the component (metadataInput triggers internal loading)
            canvas.metadataInput = data;

            // UI feedback
            document.getElementById('fileInfo').textContent = `Geladen: ${filename}`;

            // Show JSON preview
            const preview = document.getElementById('jsonPreview');
            preview.textContent = JSON.stringify(data, null, 2);
            preview.style.display = 'block';
        }

        /**
         * Switch layout
         */
        function switchLayout(layout, btn) {
            document.getElementById('canvas').setAttribute('layout', layout);
            document.querySelectorAll('.layout-switch button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // Auto-load example on page load if ?autoload parameter is set
        const params = new URLSearchParams(window.location.search);
        if (params.has('autoload')) {
            customElements.whenDefined('metadata-agent-canvas').then(() => {
                setTimeout(loadExampleJson, 500);
            });
        }
    </script>

</body>
</html>
